{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DiagnosticSet = exports.GraphQLDiagnostic = exports.diagnosticsFromError = exports.collectExecutableDefinitionDiagnositics = void 0;\n\nconst graphql_1 = require(\"graphql\");\n\nconst vscode_languageserver_1 = require(\"vscode-languageserver\");\n\nconst graphql_2 = require(\"./utilities/graphql\");\n\nconst source_1 = require(\"./utilities/source\");\n\nconst validation_1 = require(\"./errors/validation\");\n\nfunction collectExecutableDefinitionDiagnositics(schema, queryDocument, fragments = {}, rules) {\n  const ast = queryDocument.ast;\n  if (!ast) return queryDocument.syntaxErrors;\n  const astWithExecutableDefinitions = Object.assign(Object.assign({}, ast), {\n    definitions: ast.definitions.filter(graphql_1.isExecutableDefinitionNode)\n  });\n  const diagnostics = [];\n\n  for (const error of validation_1.getValidationErrors(schema, astWithExecutableDefinitions, fragments, rules)) {\n    diagnostics.push(...diagnosticsFromError(error, vscode_languageserver_1.DiagnosticSeverity.Error, \"Validation\"));\n  }\n\n  for (const error of graphql_1.findDeprecatedUsages(schema, astWithExecutableDefinitions)) {\n    diagnostics.push(...diagnosticsFromError(error, vscode_languageserver_1.DiagnosticSeverity.Warning, \"Deprecation\"));\n  }\n\n  return diagnostics;\n}\n\nexports.collectExecutableDefinitionDiagnositics = collectExecutableDefinitionDiagnositics;\n\nfunction diagnosticsFromError(error, severity, type) {\n  if (!error.nodes) {\n    return [];\n  }\n\n  return error.nodes.map(node => {\n    return {\n      source: `GraphQL: ${type}`,\n      message: error.message,\n      severity,\n      range: source_1.rangeForASTNode(graphql_2.highlightNodeForNode(node) || node),\n      error\n    };\n  });\n}\n\nexports.diagnosticsFromError = diagnosticsFromError;\nvar GraphQLDiagnostic;\n\n(function (GraphQLDiagnostic) {\n  function is(diagnostic) {\n    return \"error\" in diagnostic;\n  }\n\n  GraphQLDiagnostic.is = is;\n})(GraphQLDiagnostic = exports.GraphQLDiagnostic || (exports.GraphQLDiagnostic = {}));\n\nclass DiagnosticSet {\n  constructor() {\n    this.diagnosticsByFile = new Map();\n  }\n\n  entries() {\n    return this.diagnosticsByFile.entries();\n  }\n\n  addDiagnostics(uri, diagnostics) {\n    const existingDiagnostics = this.diagnosticsByFile.get(uri);\n\n    if (!existingDiagnostics) {\n      this.diagnosticsByFile.set(uri, diagnostics);\n    } else {\n      existingDiagnostics.push(...diagnostics);\n    }\n  }\n\n}\n\nexports.DiagnosticSet = DiagnosticSet;","map":{"version":3,"sources":["../src/diagnostics.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DiagnosticSet = exports.GraphQLDiagnostic = exports.diagnosticsFromError = exports.collectExecutableDefinitionDiagnositics = void 0;\nconst graphql_1 = require(\"graphql\");\nconst vscode_languageserver_1 = require(\"vscode-languageserver\");\nconst graphql_2 = require(\"./utilities/graphql\");\nconst source_1 = require(\"./utilities/source\");\nconst validation_1 = require(\"./errors/validation\");\nfunction collectExecutableDefinitionDiagnositics(schema, queryDocument, fragments = {}, rules) {\n    const ast = queryDocument.ast;\n    if (!ast)\n        return queryDocument.syntaxErrors;\n    const astWithExecutableDefinitions = Object.assign(Object.assign({}, ast), { definitions: ast.definitions.filter(graphql_1.isExecutableDefinitionNode) });\n    const diagnostics = [];\n    for (const error of validation_1.getValidationErrors(schema, astWithExecutableDefinitions, fragments, rules)) {\n        diagnostics.push(...diagnosticsFromError(error, vscode_languageserver_1.DiagnosticSeverity.Error, \"Validation\"));\n    }\n    for (const error of graphql_1.findDeprecatedUsages(schema, astWithExecutableDefinitions)) {\n        diagnostics.push(...diagnosticsFromError(error, vscode_languageserver_1.DiagnosticSeverity.Warning, \"Deprecation\"));\n    }\n    return diagnostics;\n}\nexports.collectExecutableDefinitionDiagnositics = collectExecutableDefinitionDiagnositics;\nfunction diagnosticsFromError(error, severity, type) {\n    if (!error.nodes) {\n        return [];\n    }\n    return error.nodes.map(node => {\n        return {\n            source: `GraphQL: ${type}`,\n            message: error.message,\n            severity,\n            range: source_1.rangeForASTNode(graphql_2.highlightNodeForNode(node) || node),\n            error\n        };\n    });\n}\nexports.diagnosticsFromError = diagnosticsFromError;\nvar GraphQLDiagnostic;\n(function (GraphQLDiagnostic) {\n    function is(diagnostic) {\n        return \"error\" in diagnostic;\n    }\n    GraphQLDiagnostic.is = is;\n})(GraphQLDiagnostic = exports.GraphQLDiagnostic || (exports.GraphQLDiagnostic = {}));\nclass DiagnosticSet {\n    constructor() {\n        this.diagnosticsByFile = new Map();\n    }\n    entries() {\n        return this.diagnosticsByFile.entries();\n    }\n    addDiagnostics(uri, diagnostics) {\n        const existingDiagnostics = this.diagnosticsByFile.get(uri);\n        if (!existingDiagnostics) {\n            this.diagnosticsByFile.set(uri, diagnostics);\n        }\n        else {\n            existingDiagnostics.push(...diagnostics);\n        }\n    }\n}\nexports.DiagnosticSet = DiagnosticSet;\n//# sourceMappingURL=diagnostics.js.map"]},"metadata":{},"sourceType":"script"}