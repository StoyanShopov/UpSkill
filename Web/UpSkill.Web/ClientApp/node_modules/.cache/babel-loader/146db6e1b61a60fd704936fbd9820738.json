{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GraphQLProject = void 0;\n\nconst path_1 = require(\"path\");\n\nconst fs_1 = require(\"fs\");\n\nconst vscode_uri_1 = __importDefault(require(\"vscode-uri\"));\n\nconst graphql_1 = require(\"graphql\");\n\nconst vscode_languageserver_1 = require(\"vscode-languageserver\");\n\nconst document_1 = require(\"../document\");\n\nconst config_1 = require(\"../config\");\n\nconst schema_1 = require(\"../providers/schema\");\n\nconst engine_1 = require(\"../engine\");\n\nconst fileAssociations = {\n  \".graphql\": \"graphql\",\n  \".gql\": \"graphql\",\n  \".js\": \"javascript\",\n  \".ts\": \"typescript\",\n  \".jsx\": \"javascriptreact\",\n  \".tsx\": \"typescriptreact\",\n  \".vue\": \"vue\",\n  \".py\": \"python\",\n  \".rb\": \"ruby\",\n  \".dart\": \"dart\",\n  \".re\": \"reason\",\n  \".ex\": \"elixir\",\n  \".exs\": \"elixir\"\n};\n\nclass GraphQLProject {\n  constructor({\n    config,\n    fileSet,\n    loadingHandler,\n    clientIdentity\n  }) {\n    this.needsValidation = false;\n    this.documentsByFile = new Map();\n    this.config = config;\n    this.fileSet = fileSet;\n    this.loadingHandler = loadingHandler;\n    this.schemaProvider = schema_1.schemaProviderFromConfig(config, clientIdentity);\n    const {\n      engine\n    } = config;\n\n    if (engine.apiKey) {\n      this.engineClient = new engine_1.ApolloEngineClient(engine.apiKey, engine.endpoint, clientIdentity);\n    }\n\n    this._isReady = false;\n    this.readyPromise = Promise.all(this.initialize()).then(() => {\n      this._isReady = true;\n    }).catch(error => {\n      console.error(error);\n      this.loadingHandler.showError(`Error initializing Apollo GraphQL project \"${this.displayName}\": ${error}`);\n    });\n  }\n\n  get isReady() {\n    return this._isReady;\n  }\n\n  get engine() {\n    if (!this.engineClient) {\n      throw new Error(`Unable to find ${config_1.keyEnvVar}`);\n    }\n\n    return this.engineClient;\n  }\n\n  get whenReady() {\n    return this.readyPromise;\n  }\n\n  updateConfig(config) {\n    this.config = config;\n    return this.initialize();\n  }\n\n  resolveSchema(config) {\n    this.lastLoadDate = +new Date();\n    return this.schemaProvider.resolveSchema(config);\n  }\n\n  resolveFederatedServiceSDL() {\n    return this.schemaProvider.resolveFederatedServiceSDL();\n  }\n\n  onSchemaChange(handler) {\n    this.lastLoadDate = +new Date();\n    return this.schemaProvider.onSchemaChange(handler);\n  }\n\n  onDiagnostics(handler) {\n    this._onDiagnostics = handler;\n  }\n\n  includesFile(uri) {\n    return this.fileSet.includesFile(uri);\n  }\n\n  async scanAllIncludedFiles() {\n    await this.loadingHandler.handle(`Loading queries for ${this.displayName}`, (async () => {\n      for (const filePath of this.fileSet.allFiles()) {\n        const uri = vscode_uri_1.default.file(filePath).toString();\n        if (this.documentsByFile.has(uri)) continue;\n        this.fileDidChange(uri);\n      }\n    })());\n  }\n\n  fileDidChange(uri) {\n    const filePath = vscode_uri_1.default.parse(uri).fsPath;\n    const extension = path_1.extname(filePath);\n    const languageId = fileAssociations[extension];\n    if (!languageId) return;\n    if (!fs_1.lstatSync(filePath).isFile()) return;\n    const contents = fs_1.readFileSync(filePath, \"utf8\");\n    const document = vscode_languageserver_1.TextDocument.create(uri, languageId, -1, contents);\n    this.documentDidChange(document);\n  }\n\n  fileWasDeleted(uri) {\n    this.removeGraphQLDocumentsFor(uri);\n    this.checkForDuplicateOperations();\n  }\n\n  documentDidChange(document) {\n    const documents = document_1.extractGraphQLDocuments(document, this.config.client && this.config.client.tagName);\n\n    if (documents) {\n      this.documentsByFile.set(document.uri, documents);\n      this.invalidate();\n    } else {\n      this.removeGraphQLDocumentsFor(document.uri);\n    }\n\n    this.checkForDuplicateOperations();\n  }\n\n  checkForDuplicateOperations() {\n    const operations = Object.create(null);\n\n    for (const document of this.documents) {\n      if (!document.ast) continue;\n\n      for (const definition of document.ast.definitions) {\n        if (definition.kind === graphql_1.Kind.OPERATION_DEFINITION && definition.name) {\n          if (operations[definition.name.value]) {\n            throw new Error(`️️There are multiple definitions for the \\`${definition.name.value}\\` operation. Please rename or remove all operations with the duplicated name before continuing.`);\n          }\n\n          operations[definition.name.value] = definition;\n        }\n      }\n    }\n  }\n\n  removeGraphQLDocumentsFor(uri) {\n    if (this.documentsByFile.has(uri)) {\n      this.documentsByFile.delete(uri);\n\n      if (this._onDiagnostics) {\n        this._onDiagnostics({\n          uri: uri,\n          diagnostics: []\n        });\n      }\n\n      this.invalidate();\n    }\n  }\n\n  invalidate() {\n    if (!this.needsValidation && this.isReady) {\n      setTimeout(() => {\n        this.validateIfNeeded();\n      }, 0);\n      this.needsValidation = true;\n    }\n  }\n\n  validateIfNeeded() {\n    if (!this.needsValidation || !this.isReady) return;\n    this.validate();\n    this.needsValidation = false;\n  }\n\n  clearAllDiagnostics() {\n    if (!this._onDiagnostics) return;\n\n    for (const uri of this.documentsByFile.keys()) {\n      this._onDiagnostics({\n        uri,\n        diagnostics: []\n      });\n    }\n  }\n\n  documentsAt(uri) {\n    return this.documentsByFile.get(uri);\n  }\n\n  documentAt(uri, position) {\n    const queryDocuments = this.documentsByFile.get(uri);\n    if (!queryDocuments) return undefined;\n    return queryDocuments.find(document => document.containsPosition(position));\n  }\n\n  get documents() {\n    const documents = [];\n\n    for (const documentsForFile of this.documentsByFile.values()) {\n      documents.push(...documentsForFile);\n    }\n\n    return documents;\n  }\n\n  get definitions() {\n    const definitions = [];\n\n    for (const document of this.documents) {\n      if (!document.ast) continue;\n      definitions.push(...document.ast.definitions);\n    }\n\n    return definitions;\n  }\n\n  definitionsAt(uri) {\n    const documents = this.documentsAt(uri);\n    if (!documents) return [];\n    const definitions = [];\n\n    for (const document of documents) {\n      if (!document.ast) continue;\n      definitions.push(...document.ast.definitions);\n    }\n\n    return definitions;\n  }\n\n  get typeSystemDefinitionsAndExtensions() {\n    const definitionsAndExtensions = [];\n\n    for (const document of this.documents) {\n      if (!document.ast) continue;\n\n      for (const definition of document.ast.definitions) {\n        if (graphql_1.isTypeSystemDefinitionNode(definition) || graphql_1.isTypeSystemExtensionNode(definition)) {\n          definitionsAndExtensions.push(definition);\n        }\n      }\n    }\n\n    return definitionsAndExtensions;\n  }\n\n}\n\nexports.GraphQLProject = GraphQLProject;","map":{"version":3,"sources":["../../src/project/base.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GraphQLProject = void 0;\nconst path_1 = require(\"path\");\nconst fs_1 = require(\"fs\");\nconst vscode_uri_1 = __importDefault(require(\"vscode-uri\"));\nconst graphql_1 = require(\"graphql\");\nconst vscode_languageserver_1 = require(\"vscode-languageserver\");\nconst document_1 = require(\"../document\");\nconst config_1 = require(\"../config\");\nconst schema_1 = require(\"../providers/schema\");\nconst engine_1 = require(\"../engine\");\nconst fileAssociations = {\n    \".graphql\": \"graphql\",\n    \".gql\": \"graphql\",\n    \".js\": \"javascript\",\n    \".ts\": \"typescript\",\n    \".jsx\": \"javascriptreact\",\n    \".tsx\": \"typescriptreact\",\n    \".vue\": \"vue\",\n    \".py\": \"python\",\n    \".rb\": \"ruby\",\n    \".dart\": \"dart\",\n    \".re\": \"reason\",\n    \".ex\": \"elixir\",\n    \".exs\": \"elixir\"\n};\nclass GraphQLProject {\n    constructor({ config, fileSet, loadingHandler, clientIdentity }) {\n        this.needsValidation = false;\n        this.documentsByFile = new Map();\n        this.config = config;\n        this.fileSet = fileSet;\n        this.loadingHandler = loadingHandler;\n        this.schemaProvider = schema_1.schemaProviderFromConfig(config, clientIdentity);\n        const { engine } = config;\n        if (engine.apiKey) {\n            this.engineClient = new engine_1.ApolloEngineClient(engine.apiKey, engine.endpoint, clientIdentity);\n        }\n        this._isReady = false;\n        this.readyPromise = Promise.all(this.initialize())\n            .then(() => {\n            this._isReady = true;\n        })\n            .catch(error => {\n            console.error(error);\n            this.loadingHandler.showError(`Error initializing Apollo GraphQL project \"${this.displayName}\": ${error}`);\n        });\n    }\n    get isReady() {\n        return this._isReady;\n    }\n    get engine() {\n        if (!this.engineClient) {\n            throw new Error(`Unable to find ${config_1.keyEnvVar}`);\n        }\n        return this.engineClient;\n    }\n    get whenReady() {\n        return this.readyPromise;\n    }\n    updateConfig(config) {\n        this.config = config;\n        return this.initialize();\n    }\n    resolveSchema(config) {\n        this.lastLoadDate = +new Date();\n        return this.schemaProvider.resolveSchema(config);\n    }\n    resolveFederatedServiceSDL() {\n        return this.schemaProvider.resolveFederatedServiceSDL();\n    }\n    onSchemaChange(handler) {\n        this.lastLoadDate = +new Date();\n        return this.schemaProvider.onSchemaChange(handler);\n    }\n    onDiagnostics(handler) {\n        this._onDiagnostics = handler;\n    }\n    includesFile(uri) {\n        return this.fileSet.includesFile(uri);\n    }\n    async scanAllIncludedFiles() {\n        await this.loadingHandler.handle(`Loading queries for ${this.displayName}`, (async () => {\n            for (const filePath of this.fileSet.allFiles()) {\n                const uri = vscode_uri_1.default.file(filePath).toString();\n                if (this.documentsByFile.has(uri))\n                    continue;\n                this.fileDidChange(uri);\n            }\n        })());\n    }\n    fileDidChange(uri) {\n        const filePath = vscode_uri_1.default.parse(uri).fsPath;\n        const extension = path_1.extname(filePath);\n        const languageId = fileAssociations[extension];\n        if (!languageId)\n            return;\n        if (!fs_1.lstatSync(filePath).isFile())\n            return;\n        const contents = fs_1.readFileSync(filePath, \"utf8\");\n        const document = vscode_languageserver_1.TextDocument.create(uri, languageId, -1, contents);\n        this.documentDidChange(document);\n    }\n    fileWasDeleted(uri) {\n        this.removeGraphQLDocumentsFor(uri);\n        this.checkForDuplicateOperations();\n    }\n    documentDidChange(document) {\n        const documents = document_1.extractGraphQLDocuments(document, this.config.client && this.config.client.tagName);\n        if (documents) {\n            this.documentsByFile.set(document.uri, documents);\n            this.invalidate();\n        }\n        else {\n            this.removeGraphQLDocumentsFor(document.uri);\n        }\n        this.checkForDuplicateOperations();\n    }\n    checkForDuplicateOperations() {\n        const operations = Object.create(null);\n        for (const document of this.documents) {\n            if (!document.ast)\n                continue;\n            for (const definition of document.ast.definitions) {\n                if (definition.kind === graphql_1.Kind.OPERATION_DEFINITION && definition.name) {\n                    if (operations[definition.name.value]) {\n                        throw new Error(`️️There are multiple definitions for the \\`${definition.name.value}\\` operation. Please rename or remove all operations with the duplicated name before continuing.`);\n                    }\n                    operations[definition.name.value] = definition;\n                }\n            }\n        }\n    }\n    removeGraphQLDocumentsFor(uri) {\n        if (this.documentsByFile.has(uri)) {\n            this.documentsByFile.delete(uri);\n            if (this._onDiagnostics) {\n                this._onDiagnostics({ uri: uri, diagnostics: [] });\n            }\n            this.invalidate();\n        }\n    }\n    invalidate() {\n        if (!this.needsValidation && this.isReady) {\n            setTimeout(() => {\n                this.validateIfNeeded();\n            }, 0);\n            this.needsValidation = true;\n        }\n    }\n    validateIfNeeded() {\n        if (!this.needsValidation || !this.isReady)\n            return;\n        this.validate();\n        this.needsValidation = false;\n    }\n    clearAllDiagnostics() {\n        if (!this._onDiagnostics)\n            return;\n        for (const uri of this.documentsByFile.keys()) {\n            this._onDiagnostics({ uri, diagnostics: [] });\n        }\n    }\n    documentsAt(uri) {\n        return this.documentsByFile.get(uri);\n    }\n    documentAt(uri, position) {\n        const queryDocuments = this.documentsByFile.get(uri);\n        if (!queryDocuments)\n            return undefined;\n        return queryDocuments.find(document => document.containsPosition(position));\n    }\n    get documents() {\n        const documents = [];\n        for (const documentsForFile of this.documentsByFile.values()) {\n            documents.push(...documentsForFile);\n        }\n        return documents;\n    }\n    get definitions() {\n        const definitions = [];\n        for (const document of this.documents) {\n            if (!document.ast)\n                continue;\n            definitions.push(...document.ast.definitions);\n        }\n        return definitions;\n    }\n    definitionsAt(uri) {\n        const documents = this.documentsAt(uri);\n        if (!documents)\n            return [];\n        const definitions = [];\n        for (const document of documents) {\n            if (!document.ast)\n                continue;\n            definitions.push(...document.ast.definitions);\n        }\n        return definitions;\n    }\n    get typeSystemDefinitionsAndExtensions() {\n        const definitionsAndExtensions = [];\n        for (const document of this.documents) {\n            if (!document.ast)\n                continue;\n            for (const definition of document.ast.definitions) {\n                if (graphql_1.isTypeSystemDefinitionNode(definition) ||\n                    graphql_1.isTypeSystemExtensionNode(definition)) {\n                    definitionsAndExtensions.push(definition);\n                }\n            }\n        }\n        return definitionsAndExtensions;\n    }\n}\nexports.GraphQLProject = GraphQLProject;\n//# sourceMappingURL=base.js.map"]},"metadata":{},"sourceType":"script"}