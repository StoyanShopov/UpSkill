{"ast":null,"code":"// Licensed to the .NET Foundation under one or more agreements.\n// The .NET Foundation licenses this file to you under the MIT license.\nimport { LogLevel } from \"./ILogger\";\nimport { NullLogger } from \"./Loggers\"; // Version token that will be replaced by the prepack command\n\n/** The version of the SignalR client. */\n\nexport const VERSION = \"6.0.0\";\n/** @private */\n\nexport class Arg {\n  static isRequired(val, name) {\n    if (val === null || val === undefined) {\n      throw new Error(`The '${name}' argument is required.`);\n    }\n  }\n\n  static isNotEmpty(val, name) {\n    if (!val || val.match(/^\\s*$/)) {\n      throw new Error(`The '${name}' argument should not be empty.`);\n    }\n  }\n\n  static isIn(val, values, name) {\n    // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\n    if (!(val in values)) {\n      throw new Error(`Unknown ${name} value: ${val}.`);\n    }\n  }\n\n}\n/** @private */\n\nexport class Platform {\n  static get isBrowser() {\n    return typeof window === \"object\";\n  }\n\n  static get isWebWorker() {\n    return typeof self === \"object\" && \"importScripts\" in self;\n  }\n\n  static get isNode() {\n    return !this.isBrowser && !this.isWebWorker;\n  }\n\n}\n/** @private */\n\nexport function getDataDetail(data, includeContent) {\n  let detail = \"\";\n\n  if (isArrayBuffer(data)) {\n    detail = `Binary data of length ${data.byteLength}`;\n\n    if (includeContent) {\n      detail += `. Content: '${formatArrayBuffer(data)}'`;\n    }\n  } else if (typeof data === \"string\") {\n    detail = `String data of length ${data.length}`;\n\n    if (includeContent) {\n      detail += `. Content: '${data}'`;\n    }\n  }\n\n  return detail;\n}\n/** @private */\n\nexport function formatArrayBuffer(data) {\n  const view = new Uint8Array(data); // Uint8Array.map only supports returning another Uint8Array?\n\n  let str = \"\";\n  view.forEach(num => {\n    const pad = num < 16 ? \"0\" : \"\";\n    str += `0x${pad}${num.toString(16)} `;\n  }); // Trim of trailing space.\n\n  return str.substr(0, str.length - 1);\n} // Also in signalr-protocol-msgpack/Utils.ts\n\n/** @private */\n\nexport function isArrayBuffer(val) {\n  return val && typeof ArrayBuffer !== \"undefined\" && (val instanceof ArrayBuffer || // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\n  val.constructor && val.constructor.name === \"ArrayBuffer\");\n}\n/** @private */\n\nexport async function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, options) {\n  let headers = {};\n\n  if (accessTokenFactory) {\n    const token = await accessTokenFactory();\n\n    if (token) {\n      headers = {\n        [\"Authorization\"]: `Bearer ${token}`\n      };\n    }\n  }\n\n  const [name, value] = getUserAgentHeader();\n  headers[name] = value;\n  logger.log(LogLevel.Trace, `(${transportName} transport) sending data. ${getDataDetail(content, options.logMessageContent)}.`);\n  const responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\n  const response = await httpClient.post(url, {\n    content,\n    headers: { ...headers,\n      ...options.headers\n    },\n    responseType,\n    timeout: options.timeout,\n    withCredentials: options.withCredentials\n  });\n  logger.log(LogLevel.Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\n}\n/** @private */\n\nexport function createLogger(logger) {\n  if (logger === undefined) {\n    return new ConsoleLogger(LogLevel.Information);\n  }\n\n  if (logger === null) {\n    return NullLogger.instance;\n  }\n\n  if (logger.log !== undefined) {\n    return logger;\n  }\n\n  return new ConsoleLogger(logger);\n}\n/** @private */\n\nexport class SubjectSubscription {\n  constructor(subject, observer) {\n    this._subject = subject;\n    this._observer = observer;\n  }\n\n  dispose() {\n    const index = this._subject.observers.indexOf(this._observer);\n\n    if (index > -1) {\n      this._subject.observers.splice(index, 1);\n    }\n\n    if (this._subject.observers.length === 0 && this._subject.cancelCallback) {\n      this._subject.cancelCallback().catch(_ => {});\n    }\n  }\n\n}\n/** @private */\n\nexport class ConsoleLogger {\n  constructor(minimumLogLevel) {\n    this._minLevel = minimumLogLevel;\n    this.out = console;\n  }\n\n  log(logLevel, message) {\n    if (logLevel >= this._minLevel) {\n      const msg = `[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;\n\n      switch (logLevel) {\n        case LogLevel.Critical:\n        case LogLevel.Error:\n          this.out.error(msg);\n          break;\n\n        case LogLevel.Warning:\n          this.out.warn(msg);\n          break;\n\n        case LogLevel.Information:\n          this.out.info(msg);\n          break;\n\n        default:\n          // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\n          this.out.log(msg);\n          break;\n      }\n    }\n  }\n\n}\n/** @private */\n\nexport function getUserAgentHeader() {\n  let userAgentHeaderName = \"X-SignalR-User-Agent\";\n\n  if (Platform.isNode) {\n    userAgentHeaderName = \"User-Agent\";\n  }\n\n  return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\n}\n/** @private */\n\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\n  // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\n  let userAgent = \"Microsoft SignalR/\";\n  const majorAndMinor = version.split(\".\");\n  userAgent += `${majorAndMinor[0]}.${majorAndMinor[1]}`;\n  userAgent += ` (${version}; `;\n\n  if (os && os !== \"\") {\n    userAgent += `${os}; `;\n  } else {\n    userAgent += \"Unknown OS; \";\n  }\n\n  userAgent += `${runtime}`;\n\n  if (runtimeVersion) {\n    userAgent += `; ${runtimeVersion}`;\n  } else {\n    userAgent += \"; Unknown Runtime Version\";\n  }\n\n  userAgent += \")\";\n  return userAgent;\n} // eslint-disable-next-line spaced-comment\n\n/*#__PURE__*/\n\nfunction getOsName() {\n  if (Platform.isNode) {\n    switch (process.platform) {\n      case \"win32\":\n        return \"Windows NT\";\n\n      case \"darwin\":\n        return \"macOS\";\n\n      case \"linux\":\n        return \"Linux\";\n\n      default:\n        return process.platform;\n    }\n  } else {\n    return \"\";\n  }\n} // eslint-disable-next-line spaced-comment\n\n/*#__PURE__*/\n\n\nfunction getRuntimeVersion() {\n  if (Platform.isNode) {\n    return process.versions.node;\n  }\n\n  return undefined;\n}\n\nfunction getRuntime() {\n  if (Platform.isNode) {\n    return \"NodeJS\";\n  } else {\n    return \"Browser\";\n  }\n}\n/** @private */\n\n\nexport function getErrorString(e) {\n  if (e.stack) {\n    return e.stack;\n  } else if (e.message) {\n    return e.message;\n  }\n\n  return `${e}`;\n}\n/** @private */\n\nexport function getGlobalThis() {\n  // globalThis is semi-new and not available in Node until v12\n  if (typeof globalThis !== \"undefined\") {\n    return globalThis;\n  }\n\n  if (typeof self !== \"undefined\") {\n    return self;\n  }\n\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n\n  throw new Error(\"could not find global\");\n}","map":{"version":3,"sources":["../../src/Utils.ts"],"names":[],"mappings":"AAAA;AACA;AAGA,SAAkB,QAAlB,QAAkC,WAAlC;AACA,SAAS,UAAT,QAA2B,WAA3B,C,CAKA;;AACA;;AAEA,OAAO,MAAM,OAAO,GAAW,OAAxB;AACP;;AACA,OAAM,MAAO,GAAP,CAAU;AACY,SAAV,UAAU,CAAC,GAAD,EAAW,IAAX,EAAuB;AAC3C,QAAI,GAAG,KAAK,IAAR,IAAgB,GAAG,KAAK,SAA5B,EAAuC;AACnC,YAAM,IAAI,KAAJ,CAAU,QAAQ,IAAI,yBAAtB,CAAN;AACH;AACJ;;AACuB,SAAV,UAAU,CAAC,GAAD,EAAc,IAAd,EAA0B;AAC9C,QAAI,CAAC,GAAD,IAAQ,GAAG,CAAC,KAAJ,CAAU,OAAV,CAAZ,EAAgC;AAC5B,YAAM,IAAI,KAAJ,CAAU,QAAQ,IAAI,iCAAtB,CAAN;AACH;AACJ;;AAEiB,SAAJ,IAAI,CAAC,GAAD,EAAW,MAAX,EAAwB,IAAxB,EAAoC;AAClD;AACA,QAAI,EAAE,GAAG,IAAI,MAAT,CAAJ,EAAsB;AAClB,YAAM,IAAI,KAAJ,CAAU,WAAW,IAAI,WAAW,GAAG,GAAvC,CAAN;AACH;AACJ;;AAjBW;AAoBhB;;AACA,OAAM,MAAO,QAAP,CAAe;AACU,aAAT,SAAS,GAAA;AACvB,WAAO,OAAO,MAAP,KAAkB,QAAzB;AACH;;AAE4B,aAAX,WAAW,GAAA;AACzB,WAAO,OAAO,IAAP,KAAgB,QAAhB,IAA4B,mBAAmB,IAAtD;AACH;;AAEuB,aAAN,MAAM,GAAA;AACpB,WAAO,CAAC,KAAK,SAAN,IAAmB,CAAC,KAAK,WAAhC;AACH;;AAXgB;AAcrB;;AACA,OAAM,SAAU,aAAV,CAAwB,IAAxB,EAAmC,cAAnC,EAA0D;AAC5D,MAAI,MAAM,GAAG,EAAb;;AACA,MAAI,aAAa,CAAC,IAAD,CAAjB,EAAyB;AACrB,IAAA,MAAM,GAAG,yBAAyB,IAAI,CAAC,UAAU,EAAjD;;AACA,QAAI,cAAJ,EAAoB;AAChB,MAAA,MAAM,IAAI,eAAe,iBAAiB,CAAC,IAAD,CAAM,GAAhD;AACH;AACJ,GALD,MAKO,IAAI,OAAO,IAAP,KAAgB,QAApB,EAA8B;AACjC,IAAA,MAAM,GAAG,yBAAyB,IAAI,CAAC,MAAM,EAA7C;;AACA,QAAI,cAAJ,EAAoB;AAChB,MAAA,MAAM,IAAI,eAAe,IAAI,GAA7B;AACH;AACJ;;AACD,SAAO,MAAP;AACH;AAED;;AACA,OAAM,SAAU,iBAAV,CAA4B,IAA5B,EAA6C;AAC/C,QAAM,IAAI,GAAG,IAAI,UAAJ,CAAe,IAAf,CAAb,CAD+C,CAG/C;;AACA,MAAI,GAAG,GAAG,EAAV;AACA,EAAA,IAAI,CAAC,OAAL,CAAc,GAAD,IAAQ;AACjB,UAAM,GAAG,GAAG,GAAG,GAAG,EAAN,GAAW,GAAX,GAAiB,EAA7B;AACA,IAAA,GAAG,IAAI,KAAK,GAAG,GAAG,GAAG,CAAC,QAAJ,CAAa,EAAb,CAAgB,GAAlC;AACH,GAHD,EAL+C,CAU/C;;AACA,SAAO,GAAG,CAAC,MAAJ,CAAW,CAAX,EAAc,GAAG,CAAC,MAAJ,GAAa,CAA3B,CAAP;AACH,C,CAED;;AACA;;AACA,OAAM,SAAU,aAAV,CAAwB,GAAxB,EAAgC;AAClC,SAAO,GAAG,IAAI,OAAO,WAAP,KAAuB,WAA9B,KACF,GAAG,YAAY,WAAf,IACG;AACC,EAAA,GAAG,CAAC,WAAJ,IAAmB,GAAG,CAAC,WAAJ,CAAgB,IAAhB,KAAyB,aAH9C,CAAP;AAIH;AAED;;AACA,OAAO,eAAe,WAAf,CAA2B,MAA3B,EAA4C,aAA5C,EAAmE,UAAnE,EAA2F,GAA3F,EAAwG,kBAAxG,EAC2B,OAD3B,EAC0D,OAD1D,EACyF;AAC5F,MAAI,OAAO,GAA0B,EAArC;;AACA,MAAI,kBAAJ,EAAwB;AACpB,UAAM,KAAK,GAAG,MAAM,kBAAkB,EAAtC;;AACA,QAAI,KAAJ,EAAW;AACP,MAAA,OAAO,GAAG;AACN,SAAC,eAAD,GAAmB,UAAU,KAAK;AAD5B,OAAV;AAGH;AACJ;;AAED,QAAM,CAAC,IAAD,EAAO,KAAP,IAAgB,kBAAkB,EAAxC;AACA,EAAA,OAAO,CAAC,IAAD,CAAP,GAAgB,KAAhB;AAEA,EAAA,MAAM,CAAC,GAAP,CAAW,QAAQ,CAAC,KAApB,EAA2B,IAAI,aAAa,6BAA6B,aAAa,CAAC,OAAD,EAAU,OAAO,CAAC,iBAAlB,CAAqC,GAA3H;AAEA,QAAM,YAAY,GAAG,aAAa,CAAC,OAAD,CAAb,GAAyB,aAAzB,GAAyC,MAA9D;AACA,QAAM,QAAQ,GAAG,MAAM,UAAU,CAAC,IAAX,CAAgB,GAAhB,EAAqB;AACxC,IAAA,OADwC;AAExC,IAAA,OAAO,EAAE,EAAE,GAAG,OAAL;AAAc,SAAG,OAAO,CAAC;AAAzB,KAF+B;AAGxC,IAAA,YAHwC;AAIxC,IAAA,OAAO,EAAE,OAAO,CAAC,OAJuB;AAKxC,IAAA,eAAe,EAAE,OAAO,CAAC;AALe,GAArB,CAAvB;AAQA,EAAA,MAAM,CAAC,GAAP,CAAW,QAAQ,CAAC,KAApB,EAA2B,IAAI,aAAa,kDAAkD,QAAQ,CAAC,UAAU,GAAjH;AACH;AAED;;AACA,OAAM,SAAU,YAAV,CAAuB,MAAvB,EAAkD;AACpD,MAAI,MAAM,KAAK,SAAf,EAA0B;AACtB,WAAO,IAAI,aAAJ,CAAkB,QAAQ,CAAC,WAA3B,CAAP;AACH;;AAED,MAAI,MAAM,KAAK,IAAf,EAAqB;AACjB,WAAO,UAAU,CAAC,QAAlB;AACH;;AAED,MAAK,MAAkB,CAAC,GAAnB,KAA2B,SAAhC,EAA2C;AACvC,WAAO,MAAP;AACH;;AAED,SAAO,IAAI,aAAJ,CAAkB,MAAlB,CAAP;AACH;AAED;;AACA,OAAM,MAAO,mBAAP,CAA0B;AAI5B,EAAA,WAAA,CAAY,OAAZ,EAAiC,QAAjC,EAA+D;AAC3D,SAAK,QAAL,GAAgB,OAAhB;AACA,SAAK,SAAL,GAAiB,QAAjB;AACH;;AAEM,EAAA,OAAO,GAAA;AACV,UAAM,KAAK,GAAW,KAAK,QAAL,CAAc,SAAd,CAAwB,OAAxB,CAAgC,KAAK,SAArC,CAAtB;;AACA,QAAI,KAAK,GAAG,CAAC,CAAb,EAAgB;AACZ,WAAK,QAAL,CAAc,SAAd,CAAwB,MAAxB,CAA+B,KAA/B,EAAsC,CAAtC;AACH;;AAED,QAAI,KAAK,QAAL,CAAc,SAAd,CAAwB,MAAxB,KAAmC,CAAnC,IAAwC,KAAK,QAAL,CAAc,cAA1D,EAA0E;AACtE,WAAK,QAAL,CAAc,cAAd,GAA+B,KAA/B,CAAsC,CAAD,IAAM,CAAI,CAA/C;AACH;AACJ;;AAlB2B;AAqBhC;;AACA,OAAM,MAAO,aAAP,CAAoB;AAWtB,EAAA,WAAA,CAAY,eAAZ,EAAqC;AACjC,SAAK,SAAL,GAAiB,eAAjB;AACA,SAAK,GAAL,GAAW,OAAX;AACH;;AAEM,EAAA,GAAG,CAAC,QAAD,EAAqB,OAArB,EAAoC;AAC1C,QAAI,QAAQ,IAAI,KAAK,SAArB,EAAgC;AAC5B,YAAM,GAAG,GAAG,IAAI,IAAI,IAAJ,GAAW,WAAX,EAAwB,KAAK,QAAQ,CAAC,QAAD,CAAU,KAAK,OAAO,EAA3E;;AACA,cAAQ,QAAR;AACI,aAAK,QAAQ,CAAC,QAAd;AACA,aAAK,QAAQ,CAAC,KAAd;AACI,eAAK,GAAL,CAAS,KAAT,CAAe,GAAf;AACA;;AACJ,aAAK,QAAQ,CAAC,OAAd;AACI,eAAK,GAAL,CAAS,IAAT,CAAc,GAAd;AACA;;AACJ,aAAK,QAAQ,CAAC,WAAd;AACI,eAAK,GAAL,CAAS,IAAT,CAAc,GAAd;AACA;;AACJ;AACI;AACA,eAAK,GAAL,CAAS,GAAT,CAAa,GAAb;AACA;AAdR;AAgBH;AACJ;;AApCqB;AAuC1B;;AACA,OAAM,SAAU,kBAAV,GAA4B;AAC9B,MAAI,mBAAmB,GAAG,sBAA1B;;AACA,MAAI,QAAQ,CAAC,MAAb,EAAqB;AACjB,IAAA,mBAAmB,GAAG,YAAtB;AACH;;AACD,SAAO,CAAE,mBAAF,EAAuB,kBAAkB,CAAC,OAAD,EAAU,SAAS,EAAnB,EAAuB,UAAU,EAAjC,EAAqC,iBAAiB,EAAtD,CAAzC,CAAP;AACH;AAED;;AACA,OAAM,SAAU,kBAAV,CAA6B,OAA7B,EAA8C,EAA9C,EAA0D,OAA1D,EAA2E,cAA3E,EAA6G;AAC/G;AACA,MAAI,SAAS,GAAW,oBAAxB;AAEA,QAAM,aAAa,GAAG,OAAO,CAAC,KAAR,CAAc,GAAd,CAAtB;AACA,EAAA,SAAS,IAAI,GAAG,aAAa,CAAC,CAAD,CAAG,IAAI,aAAa,CAAC,CAAD,CAAG,EAApD;AACA,EAAA,SAAS,IAAI,KAAK,OAAO,IAAzB;;AAEA,MAAI,EAAE,IAAI,EAAE,KAAK,EAAjB,EAAqB;AACjB,IAAA,SAAS,IAAI,GAAG,EAAE,IAAlB;AACH,GAFD,MAEO;AACH,IAAA,SAAS,IAAI,cAAb;AACH;;AAED,EAAA,SAAS,IAAI,GAAG,OAAO,EAAvB;;AAEA,MAAI,cAAJ,EAAoB;AAChB,IAAA,SAAS,IAAI,KAAK,cAAc,EAAhC;AACH,GAFD,MAEO;AACH,IAAA,SAAS,IAAI,2BAAb;AACH;;AAED,EAAA,SAAS,IAAI,GAAb;AACA,SAAO,SAAP;AACH,C,CAED;;AACA;;AAAc,SAAS,SAAT,GAAkB;AAC5B,MAAI,QAAQ,CAAC,MAAb,EAAqB;AACjB,YAAQ,OAAO,CAAC,QAAhB;AACI,WAAK,OAAL;AACI,eAAO,YAAP;;AACJ,WAAK,QAAL;AACI,eAAO,OAAP;;AACJ,WAAK,OAAL;AACI,eAAO,OAAP;;AACJ;AACI,eAAO,OAAO,CAAC,QAAf;AARR;AAUH,GAXD,MAWO;AACH,WAAO,EAAP;AACH;AACJ,C,CAED;;AACA;;;AAAc,SAAS,iBAAT,GAA0B;AACpC,MAAI,QAAQ,CAAC,MAAb,EAAqB;AACjB,WAAO,OAAO,CAAC,QAAR,CAAiB,IAAxB;AACH;;AACD,SAAO,SAAP;AACH;;AAED,SAAS,UAAT,GAAmB;AACf,MAAI,QAAQ,CAAC,MAAb,EAAqB;AACjB,WAAO,QAAP;AACH,GAFD,MAEO;AACH,WAAO,SAAP;AACH;AACJ;AAED;;;AACA,OAAM,SAAU,cAAV,CAAyB,CAAzB,EAA+B;AACjC,MAAI,CAAC,CAAC,KAAN,EAAa;AACT,WAAO,CAAC,CAAC,KAAT;AACH,GAFD,MAEO,IAAI,CAAC,CAAC,OAAN,EAAe;AAClB,WAAO,CAAC,CAAC,OAAT;AACH;;AACD,SAAO,GAAG,CAAC,EAAX;AACH;AAED;;AACA,OAAM,SAAU,aAAV,GAAuB;AACzB;AACA,MAAI,OAAO,UAAP,KAAsB,WAA1B,EAAuC;AACnC,WAAO,UAAP;AACH;;AACD,MAAI,OAAO,IAAP,KAAgB,WAApB,EAAiC;AAC7B,WAAO,IAAP;AACH;;AACD,MAAI,OAAO,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAO,MAAP;AACH;;AACD,MAAI,OAAO,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAO,MAAP;AACH;;AACD,QAAM,IAAI,KAAJ,CAAU,uBAAV,CAAN;AACH","sourcesContent":["// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { IStreamSubscriber, ISubscription } from \"./Stream\";\r\nimport { Subject } from \"./Subject\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\n\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\n\r\nexport const VERSION: string = \"0.0.0-DEV_BUILD\";\r\n/** @private */\r\nexport class Arg {\r\n    public static isRequired(val: any, name: string): void {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(`The '${name}' argument is required.`);\r\n        }\r\n    }\r\n    public static isNotEmpty(val: string, name: string): void {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(`The '${name}' argument should not be empty.`);\r\n        }\r\n    }\r\n\r\n    public static isIn(val: any, values: any, name: string): void {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(`Unknown ${name} value: ${val}.`);\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport class Platform {\r\n    public static get isBrowser(): boolean {\r\n        return typeof window === \"object\";\r\n    }\r\n\r\n    public static get isWebWorker(): boolean {\r\n        return typeof self === \"object\" && \"importScripts\" in self;\r\n    }\r\n\r\n    public static get isNode(): boolean {\r\n        return !this.isBrowser && !this.isWebWorker;\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getDataDetail(data: any, includeContent: boolean): string {\r\n    let detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = `Binary data of length ${data.byteLength}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${formatArrayBuffer(data)}'`;\r\n        }\r\n    } else if (typeof data === \"string\") {\r\n        detail = `String data of length ${data.length}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${data}'`;\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n\r\n/** @private */\r\nexport function formatArrayBuffer(data: ArrayBuffer): string {\r\n    const view = new Uint8Array(data);\r\n\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    let str = \"\";\r\n    view.forEach((num) => {\r\n        const pad = num < 16 ? \"0\" : \"\";\r\n        str += `0x${pad}${num.toString(16)} `;\r\n    });\r\n\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val: any): val is ArrayBuffer {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n\r\n/** @private */\r\nexport async function sendMessage(logger: ILogger, transportName: string, httpClient: HttpClient, url: string, accessTokenFactory: (() => string | Promise<string>) | undefined,\r\n                                  content: string | ArrayBuffer, options: IHttpConnectionOptions): Promise<void> {\r\n    let headers: {[k: string]: string} = {};\r\n    if (accessTokenFactory) {\r\n        const token = await accessTokenFactory();\r\n        if (token) {\r\n            headers = {\r\n                [\"Authorization\"]: `Bearer ${token}`,\r\n            };\r\n        }\r\n    }\r\n\r\n    const [name, value] = getUserAgentHeader();\r\n    headers[name] = value;\r\n\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) sending data. ${getDataDetail(content, options.logMessageContent!)}.`);\r\n\r\n    const responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n    const response = await httpClient.post(url, {\r\n        content,\r\n        headers: { ...headers, ...options.headers},\r\n        responseType,\r\n        timeout: options.timeout,\r\n        withCredentials: options.withCredentials,\r\n    });\r\n\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\r\n}\r\n\r\n/** @private */\r\nexport function createLogger(logger?: ILogger | LogLevel): ILogger {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n\r\n    if ((logger as ILogger).log !== undefined) {\r\n        return logger as ILogger;\r\n    }\r\n\r\n    return new ConsoleLogger(logger as LogLevel);\r\n}\r\n\r\n/** @private */\r\nexport class SubjectSubscription<T> implements ISubscription<T> {\r\n    private _subject: Subject<T>;\r\n    private _observer: IStreamSubscriber<T>;\r\n\r\n    constructor(subject: Subject<T>, observer: IStreamSubscriber<T>) {\r\n        this._subject = subject;\r\n        this._observer = observer;\r\n    }\r\n\r\n    public dispose(): void {\r\n        const index: number = this._subject.observers.indexOf(this._observer);\r\n        if (index > -1) {\r\n            this._subject.observers.splice(index, 1);\r\n        }\r\n\r\n        if (this._subject.observers.length === 0 && this._subject.cancelCallback) {\r\n            this._subject.cancelCallback().catch((_) => { });\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport class ConsoleLogger implements ILogger {\r\n    private readonly _minLevel: LogLevel;\r\n\r\n    // Public for testing purposes.\r\n    public out: {\r\n        error(message: any): void,\r\n        warn(message: any): void,\r\n        info(message: any): void,\r\n        log(message: any): void,\r\n    };\r\n\r\n    constructor(minimumLogLevel: LogLevel) {\r\n        this._minLevel = minimumLogLevel;\r\n        this.out = console;\r\n    }\r\n\r\n    public log(logLevel: LogLevel, message: string): void {\r\n        if (logLevel >= this._minLevel) {\r\n            const msg = `[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.out.error(msg);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.out.warn(msg);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.out.info(msg);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.out.log(msg);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getUserAgentHeader(): [string, string] {\r\n    let userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [ userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion()) ];\r\n}\r\n\r\n/** @private */\r\nexport function constructUserAgent(version: string, os: string, runtime: string, runtimeVersion: string | undefined): string {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    let userAgent: string = \"Microsoft SignalR/\";\r\n\r\n    const majorAndMinor = version.split(\".\");\r\n    userAgent += `${majorAndMinor[0]}.${majorAndMinor[1]}`;\r\n    userAgent += ` (${version}; `;\r\n\r\n    if (os && os !== \"\") {\r\n        userAgent += `${os}; `;\r\n    } else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n\r\n    userAgent += `${runtime}`;\r\n\r\n    if (runtimeVersion) {\r\n        userAgent += `; ${runtimeVersion}`;\r\n    } else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\n\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getOsName(): string {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    } else {\r\n        return \"\";\r\n    }\r\n}\r\n\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getRuntimeVersion(): string | undefined {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nfunction getRuntime(): string {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    } else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getErrorString(e: any): string {\r\n    if (e.stack) {\r\n        return e.stack;\r\n    } else if (e.message) {\r\n        return e.message;\r\n    }\r\n    return `${e}`;\r\n}\r\n\r\n/** @private */\r\nexport function getGlobalThis() {\r\n    // globalThis is semi-new and not available in Node until v12\r\n    if (typeof globalThis !== \"undefined\") {\r\n        return globalThis;\r\n    }\r\n    if (typeof self !== \"undefined\") {\r\n        return self;\r\n    }\r\n    if (typeof window !== \"undefined\") {\r\n        return window;\r\n    }\r\n    if (typeof global !== \"undefined\") {\r\n        return global;\r\n    }\r\n    throw new Error(\"could not find global\");\r\n}"],"sourceRoot":""},"metadata":{},"sourceType":"module"}