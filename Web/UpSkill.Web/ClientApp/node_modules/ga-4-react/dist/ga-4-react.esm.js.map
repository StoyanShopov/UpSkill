{"version":3,"file":"ga-4-react.esm.js","sources":["../src/lib/ga4manager.tsx","../src/components/GA4RComponents.tsx","../src/hooks/useGA4React.tsx","../src/components/withTracker.tsx"],"sourcesContent":["import {\n  GA4Config,\n  GA4ManagerOptionsInterface,\n  GA4ReactInterface,\n  GA4ReactResolveInterface,\n  gtagAction,\n  gtagCategory,\n  gtagFunction,\n  gtagLabel,\n} from '../models/gtagModels';\n\nexport const GA4ReactGlobalIndex = '__ga4React__';\n\ndeclare global {\n  interface Window {\n    gtag: gtagFunction | Function;\n    __ga4React__: GA4ReactResolveInterface;\n  }\n}\n\n/**\n * @desc class required to manage google analitycs 4\n * @class GA4React\n *  */\nexport class GA4React implements GA4ReactInterface {\n  private scriptSyncId: string = 'ga4ReactScriptSync';\n  private scriptAsyncId: string = 'ga4ReactScriptAsync';\n  private nonceAsync: string = '';\n  private nonceSync: string = '';\n  constructor(\n    private gaCode: string,\n    private gaConfig?: GA4Config,\n    private additionalGaCode?: Array<string>,\n    private timeout?: number,\n    private options?: GA4ManagerOptionsInterface\n  ) {\n    this.gaConfig = gaConfig ? gaConfig : {};\n    this.gaCode = gaCode;\n    this.timeout = timeout || 5000;\n    this.additionalGaCode = additionalGaCode;\n    this.options = options;\n\n    if (this.options) {\n      const { nonce } = this.options;\n      this.nonceAsync = nonce && nonce[0] ? nonce[0] : '';\n      this.nonceSync = nonce && nonce[1] ? nonce[1] : '';\n    }\n  }\n\n  /**\n   * @desc output on resolve initialization\n   */\n  private outputOnResolve(): GA4ReactResolveInterface {\n    return {\n      pageview: this.pageview,\n      event: this.event,\n      gtag: this.gtag,\n    };\n  }\n\n  /**\n   * @desc Return main function for send ga4 events, pageview etc\n   * @returns {Promise<GA4ReactResolveInterface>}\n   */\n  public initialize(): Promise<GA4ReactResolveInterface> {\n    return new Promise((resolve, reject) => {\n      if (GA4React.isInitialized()) {\n        reject(new Error('GA4React is being initialized'));\n      }\n\n      // in case of retry logics, remove previous scripts\n      const previousScriptAsync = document.getElementById(this.scriptAsyncId);\n      if (previousScriptAsync) {\n        previousScriptAsync.remove();\n      }\n\n      const head: HTMLHeadElement = document.getElementsByTagName('head')[0];\n      const scriptAsync: HTMLScriptElement = document.createElement('script');\n      scriptAsync.setAttribute('id', this.scriptAsyncId);\n      scriptAsync.setAttribute('async', '');\n\n      if (\n        this.nonceAsync &&\n        typeof this.nonceAsync === 'string' &&\n        this.nonceAsync.length > 0\n      ) {\n        scriptAsync.setAttribute('nonce', this.nonceAsync);\n      }\n\n      scriptAsync.setAttribute(\n        'src',\n        `https://www.googletagmanager.com/gtag/js?id=${this.gaCode}`\n      );\n      scriptAsync.onload = () => {\n        const target: HTMLElement | null = document.getElementById(\n          this.scriptSyncId\n        );\n        if (target) {\n          target.remove();\n        }\n\n        // in case of retry logics, remove previous script sync\n        const previousScriptSync = document.getElementById(this.scriptSyncId);\n        if (previousScriptSync) {\n          previousScriptSync.remove();\n        }\n\n        const scriptSync: HTMLScriptElement = document.createElement('script');\n\n        scriptSync.setAttribute('id', this.scriptSyncId);\n\n        if (\n          this.nonceSync &&\n          typeof this.nonceSync === 'string' &&\n          this.nonceSync.length > 0\n        ) {\n          scriptSync.setAttribute('nonce', this.nonceSync);\n        }\n\n        let scriptHTML: string = `window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);};\n        gtag('js', new Date());\n        gtag('config', '${this.gaCode}', ${JSON.stringify(this.gaConfig)});`;\n\n        if (this.additionalGaCode) {\n          this.additionalGaCode.forEach((code: string) => {\n            scriptHTML += `\\ngtag('config', '${code}', ${JSON.stringify(\n              this.gaConfig\n            )});`;\n          });\n        }\n\n        scriptSync.innerHTML = scriptHTML;\n\n        head.appendChild(scriptSync);\n\n        const resolved: GA4ReactResolveInterface = this.outputOnResolve();\n\n        Object.assign(window, { [GA4ReactGlobalIndex]: resolved });\n\n        resolve(resolved);\n      };\n\n      scriptAsync.onerror = (event: Event | string): void => {\n        if (typeof event === 'string') {\n          reject(`GA4React intialization failed ${event}`);\n        } else {\n          const error = new Error();\n          error.name = 'GA4React intialization failed';\n          error.message = JSON.stringify(event, [\n            'message',\n            'arguments',\n            'type',\n            'name',\n          ]);\n          reject(error);\n        }\n      };\n\n      const onChangeReadyState = () => {\n        switch (document.readyState) {\n          case 'interactive':\n          case 'complete':\n            if (!GA4React.isInitialized()) {\n              head.appendChild(scriptAsync);\n              document.removeEventListener(\n                'readystatechange',\n                onChangeReadyState\n              );\n            }\n            break;\n        }\n      };\n\n      if (document.readyState !== 'complete') {\n        document.addEventListener('readystatechange', onChangeReadyState);\n      } else {\n        onChangeReadyState();\n      }\n\n      setTimeout(() => {\n        reject(new Error('GA4React Timeout'));\n      }, this.timeout);\n    });\n  }\n\n  /**\n   * @desc send pageview event to gtag\n   * @param path\n   */\n  public pageview(\n    path: string | Location,\n    location?: string | Location,\n    title?: string\n  ): any {\n    return this.gtag('event', 'page_view', {\n      page_path: path,\n      page_location: location || window.location,\n      page_title: title || document.title,\n    });\n  }\n\n  /**\n   * @desc set event and send to gtag\n   * @param action\n   * @param label\n   * @param category\n   * @param nonInteraction\n   */\n  public event(\n    action: gtagAction,\n    label: gtagLabel,\n    category: gtagCategory,\n    nonInteraction: boolean = false\n  ): any {\n    return this.gtag('event', action, {\n      event_label: label,\n      event_category: category,\n      non_interaction: nonInteraction,\n    });\n  }\n\n  /**\n   * @desc direct access to gtag\n   * @param args\n   */\n  public gtag(...args: any): any {\n    //@ts-ignore\n    return window.gtag(...args);\n  }\n\n  /**\n   * @desc ga is initialized?\n   */\n  static isInitialized(): boolean {\n    switch (typeof window[GA4ReactGlobalIndex] !== 'undefined') {\n      case true:\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * @desc get ga4react from global\n   */\n  static getGA4React(): GA4ReactResolveInterface | void {\n    if (GA4React.isInitialized()) {\n      return window[GA4ReactGlobalIndex];\n    } else {\n      console.error(new Error('GA4React is not initialized'));\n    }\n  }\n}\n\nexport default GA4React;\n","import React, { useState, useEffect } from 'react';\nimport GA4React from './../lib/ga4manager';\nimport {\n  GA4Config,\n  GA4ManagerOptionsInterface,\n  GA4ReactResolveInterface,\n} from '../models/gtagModels';\n\nexport interface IGA4R {\n  code: string;\n  timeout?: number;\n  config?: GA4Config;\n  additionalCode?: Array<string>;\n  children?: any;\n  options?: GA4ManagerOptionsInterface;\n}\n\nconst outputGA4 = (\n  children: any,\n  setComponents: Function,\n  ga4: GA4ReactResolveInterface\n) => {\n  setComponents(\n    React.Children.map(children, (child: React.ReactChildren, index) => {\n      if (!React.isValidElement(child)) {\n        return <React.Fragment>{child}</React.Fragment>;\n      }\n\n      //@ts-ignore\n      if (child.type && typeof child.type.name !== 'undefined') {\n        return React.cloneElement(child, {\n          //@ts-ignore\n          ga4: ga4,\n          index,\n        });\n      } else {\n        return child;\n      }\n    })\n  );\n};\n\nexport const GA4R: React.FC<IGA4R> = ({\n  code,\n  timeout,\n  config,\n  additionalCode,\n  children,\n  options,\n}) => {\n  const [components, setComponents] = useState<any>(null);\n\n  useEffect(() => {\n    if (!GA4React.isInitialized()) {\n      const ga4manager = new GA4React(\n        `${code}`,\n        config,\n        additionalCode,\n        timeout,\n        options\n      );\n      ga4manager.initialize().then(\n        (ga4: GA4ReactResolveInterface) => {\n          outputGA4(children, setComponents, ga4);\n        },\n        err => {\n          console.error(err);\n        }\n      );\n    } else {\n      const ga4 = GA4React.getGA4React();\n      if (ga4) {\n        outputGA4(children, setComponents, ga4);\n      }\n    }\n  }, []);\n\n  return <>{components}</>;\n};\n\nexport default GA4R;\n","import { useState, useEffect } from 'react';\nimport GA4React from '../lib/ga4manager';\n\nimport {\n  GA4Config,\n  GA4ManagerOptionsInterface,\n  GA4ReactResolveInterface,\n} from '../models/gtagModels';\n\nexport const useGA4React = (\n  gaCode?: string,\n  gaConfig?: GA4Config | object,\n  gaAdditionalCode?: Array<string>,\n  gaTimeout?: number,\n  options?: GA4ManagerOptionsInterface\n): GA4ReactResolveInterface | void => {\n  const [ga4, setGA4] = useState<GA4ReactResolveInterface | void>(undefined);\n  useEffect(() => {\n    if (gaCode) {\n      switch (GA4React.isInitialized()) {\n        case false:\n          const ga4react = new GA4React(\n            `${gaCode}`,\n            gaConfig,\n            gaAdditionalCode,\n            gaTimeout,\n            options\n          );\n          ga4react.initialize().then(\n            (ga4: GA4ReactResolveInterface) => {\n              setGA4(ga4);\n            },\n            (err: Error) => {\n              console.error(err);\n            }\n          );\n          break;\n        case true:\n          setGA4(GA4React.getGA4React());\n          break;\n      }\n    } else {\n      setGA4(GA4React.getGA4React());\n    }\n  }, [gaCode]);\n  return ga4;\n};\n","import React, { useEffect } from 'react';\nimport GA4React from '../lib/ga4manager';\n\nimport {\n  GA4Config,\n  GA4ManagerOptionsInterface,\n  GA4ReactResolveInterface,\n} from '../models/gtagModels';\n\nexport interface GA4WithTrackerComponentInterface {\n  path: string | Location;\n  location?: string | Location;\n  title?: string;\n  gaCode?: string;\n  gaConfig?: GA4Config | object;\n  additionalCode?: Array<string>;\n  timeout?: number;\n  options?: GA4ManagerOptionsInterface;\n}\n\nexport function withTracker(\n  MyComponent: React.FC<any>\n): React.FC<GA4WithTrackerComponentInterface> {\n  return (props: GA4WithTrackerComponentInterface & any) => {\n    const {\n      path,\n      location,\n      title,\n      gaCode,\n      gaTimeout,\n      gaConfig,\n      gaAdditionalCode,\n      options,\n    } = props;\n    useEffect(() => {\n      switch (GA4React.isInitialized()) {\n        case true:\n          const ga4 = GA4React.getGA4React();\n          if (ga4) {\n            ga4.pageview(path, location, title);\n          }\n          break;\n        default:\n        case false:\n          const ga4react = new GA4React(\n            `${gaCode}`,\n            gaConfig,\n            gaAdditionalCode,\n            gaTimeout,\n            options\n          );\n          ga4react.initialize().then(\n            (ga4: GA4ReactResolveInterface) => {\n              ga4.pageview(path, location, title);\n            },\n            (err: Error) => {\n              console.error(err);\n            }\n          );\n          break;\n      }\n    });\n    return <MyComponent {...props} />;\n  };\n}\n\nexport default withTracker;\n"],"names":["GA4ReactGlobalIndex","GA4React","constructor","gaCode","gaConfig","additionalGaCode","timeout","options","nonce","nonceAsync","nonceSync","outputOnResolve","pageview","event","gtag","initialize","Promise","resolve","reject","isInitialized","Error","previousScriptAsync","document","getElementById","scriptAsyncId","remove","head","getElementsByTagName","scriptAsync","createElement","setAttribute","length","onload","target","scriptSyncId","previousScriptSync","scriptSync","scriptHTML","JSON","stringify","forEach","code","innerHTML","appendChild","resolved","Object","assign","window","onerror","error","name","message","onChangeReadyState","readyState","removeEventListener","addEventListener","setTimeout","path","location","title","page_path","page_location","page_title","action","label","category","nonInteraction","event_label","event_category","non_interaction","getGA4React","console","outputGA4","children","setComponents","ga4","React","Children","map","child","index","isValidElement","Fragment","type","cloneElement","GA4R","config","additionalCode","components","useState","useEffect","ga4manager","then","err","useGA4React","gaAdditionalCode","gaTimeout","setGA4","undefined","ga4react","withTracker","MyComponent","props"],"mappings":"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"}